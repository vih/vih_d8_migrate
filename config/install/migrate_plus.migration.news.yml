id: news
label: News CSV
migration_group: news
dependencies:
  enforced:
    module:
      - custom_migrate
migration_dependencies:
  required:
    - news_images
source:
  plugin: csv
  path: modules/custom/custom_migrate/imports/news.csv
  header_row_count: 1
  keys:
    - nid
  column_names:
    0:
      nid: Nid
    1:
      path: Path
    2:
      title: Title
    3:
      created: Date created
    4:
      picture: Picture
    5:
      pictures: Pictures
    6:
      body: Body
    7:
      tags: Tags

process:
  type:
    plugin: default_value
    default_value: news
  uid:
    plugin: default_value
    default_value: 1
  title: title
  body: body
  created:
    -
      plugin: format_date
      from_format: 'd/m/Y - H:i'
      to_format: 'Y-m-d H:i:s'
      source: created
  'field_banner/target_id':
    -
      plugin: migration
      migration: news_images
      source: picture
  'field_banner/alt': title
  'field_image/target_id':
    -
      plugin: migration
      migration: news_images
      source: picture
  'field_image/alt': title
  # TODO Figure out how to do tags
  #field_news_tags:
  #  -
  #    plugin: explode
  #    delimiter: ', '
  #    source: tags
  #  -
  #    plugin: entity_generate
  #    entity_type: taxonomy_term
  #    value_key: name
  #    bundle: news_tags
  #    ignore_case: true
destination:
  plugin: entity:node
  default_bundle: news
