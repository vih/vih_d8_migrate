id: subjects
label: Subjects CSV
migration_group: subjects
dependencies:
  enforced:
    module:
      - custom_migrate
migration_dependencies:
  required:
    - subjects_images
    - subject_packages
source:
  plugin: csv
  path: modules/custom/custom_migrate/imports/subjects.csv
  header_row_count: 1
  keys:
    - nid
  column_names:
    0:
      nid: Nid
    1:
      path: Path
    2:
      name: Name
    3:
      teaser: Teaser
    4:
      body: Body
    5:
      picture: Picture
    6:
      pictures: Pictures
    7:
      class_packages: Class packages
process:
  type:
    plugin: default_value
    default_value: subjects
  name: name
  description: body
  field_vih_class_class_packages:
    -
      plugin: explode
      delimiter: ', '
      source: class_packages
    -
      plugin: migration
      migration: subject_packages
  'field_banner/target_id':
    plugin: migration
    migration: subjects_images
    source: picture
  'field_vih_class_image/target_id':
    plugin: migration
    migration: subjects_images
    source: picture
  # Now that we have the images in place, we also copy the alternate text
  # for the images to the "alt" property of "field_image". Having "alt"
  # would help improve accessibility and SEO.
  'field_vih_class_image/alt': name
  # TODO Make a paragraph out of the pictures field
  #  field_vih_class_image: pictures
destination:
  plugin: entity:taxonomy_term
  default_bundle: vih_class
